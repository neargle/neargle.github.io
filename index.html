<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  
  <title>Nearg1e - Web Develop&amp;Security / 安全研究 / 漏洞挖掘 / 安全开发 / Pyer / Anime</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="/js/highlight.pack.js"></script>
  <script type="text/javascript" src="http://tajs.qq.com/stats?sId=58637942" charset="UTF-8"></script>
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link rel="alternative" href="/atom.xml" title="Nearg1e" type="application/atom+xml">
  
  <!--[if lt IE 9]>
    <script type="text/javascript" src="/js/html5.js"></script>
    <script type="text/javascript" src="/js/css3-mediaqueries.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">

</head>
<body>
    <header id="header">
    <div class="nav-warp">
      <nav id="nav" class="w">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/atom.xml">RSS</a>
        
          <a class="main-nav-link" href="https://github.com/neargle">Project</a>
        
        <a id="nav-search" class="icon-search fr" onclick="show_search()" title="搜索"></a>
        <div id="nav-search-input" class="hide">
          <form class="search-form" onsubmit="return dispatch()">
            <input type="hidden" id="site" value="site:http://blog.neargle.com">
            <input type="text" id="q" class="input-text" name="q" placeholder="搜索">
            <input type="submit" value="" class="input-submit">
          </form>
        </div>
      </nav>
    </div>
    
      <div id="logo">
        <div class="hg">
        
          <h1 id="site-title">
            <a href="/">Nearg1e</a>
          </h1>
          
            <h2 id="site-description">Web Develop&amp;Security / 安全研究 / 漏洞挖掘 / 安全开发 / Pyer / Anime</h2>
          
        
          <!-- <p>微博:<a href="http://weibo.com/neargle">@Neargle</a></p> -->
        </div>
      </div>
    
  </header>

  <!-- <div id='wrap'> -->
    <div id='outer'>
      <section id="main">
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/09/28/Exploiting-Python-PIL-Module-Command-Execution-Vulnerability/">Exploiting Python PIL Module Command Execution Vulnerability</a>
      </h2>
    
  

    
<time datetime="2017-09-28T05:28:54.000Z" class="post-time">2017-09-28</time>

  </header>
  
  <section class="post-content typo">
    
      <p>这是我用来支持先知和代码审计小密圈活动的文章，首发于: <a href="https://xianzhi.aliyun.com/forum/read/2163.html">https://xianzhi.aliyun.com/forum/read/2163.html</a></p>
<p><strong>PIL</strong> (Python Image Library) 应该是 Python 图片处理库中运用最广泛的，它拥有强大的功能和简洁的API。很多Python Web应用在需要实现处理图片的功能时，都会选择使用PIL。</p>
<p>PIL在对 eps 图片格式进行处理的时候，如果环境内装有 GhostScript，则会调用 GhostScript 在dSAFER模式下处理图片，即使是最新版本的PIL模块，也会受到 <code>GhostButt CVE-2017-8291</code> dSAFER模式Bypass漏洞的影响，产生命令执行漏洞。</p>
<p>据说大牛们看源码和 dockerfile 就可以了：<a href="https://github.com/neargle/PIL-RCE-By-GhostButt">https://github.com/neargle/PIL-RCE-By-GhostButt</a></p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/Python/">#Python</a></li>
    
  </ul>

    
      <a href="/2017/09/28/Exploiting-Python-PIL-Module-Command-Execution-Vulnerability/#more" class="post-foot-link fr">阅读全文</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/09/01/use-request-merging-to-bypass-referer-check/">使用request merging bypass referer(jsonp) 检测</a>
      </h2>
    
  

    
<time datetime="2017-08-31T19:01:11.000Z" class="post-time">2017-09-01</time>

  </header>
  
  <section class="post-content typo">
    
      <p><em>更新两篇之前在其他地方发过的文章</em></p>
<h2 id="1-_关于request_merging和其会产生的问题">1. 关于request merging和其会产生的问题</h2><p>request merging : 浏览器会把多次相同的请求(并非所有请求)合并成一次，以加快资源加载速度。</p>
<p>e.g.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"http://0.0.0.0:8888/jsonp/1"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"http://0.0.0.0:8888/jsonp/1"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"http://0.0.0.0:8888/jsonp/1"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>只会请求并加载一次”<a href="http://0.0.0.0:8888/jsonp/1&quot;资源。">http://0.0.0.0:8888/jsonp/1&quot;资源。</a></p>
<p><em>曾经有研究指出，这种请求合并想象在iframe里也存在</em>，那么浏览器的这种特性就可以用来bypass部分程序的referer的判断，如jsonp的防御机制。</p>
<h2 id="2-_环境和POC">2. 环境和POC</h2><p>绕过referer检测，攻击者能否拿到进行referer保护的用户信息？</p>
<p>攻击者服务器： <a href="http://example.com:8081">http://example.com:8081</a><br>目标服务器： <a href="http://example.com:8082">http://example.com:8082</a><br>referer检测： referer是否以“<a href="http://example.com:8082”开头">http://example.com:8082”开头</a><br>目标： 攻击者拿到属于用户的 “security content”</p>
<h3 id="环境：">环境：</h3><p>/jsonp.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startsWith</span><span class="params">(<span class="variable">$url</span>, <span class="variable">$domain</span>)</span> </span>&#123;</span><br><span class="line">     <span class="variable">$length</span> = strlen(<span class="variable">$domain</span>);</span><br><span class="line">     <span class="keyword">return</span> (substr(<span class="variable">$url</span>, <span class="number">0</span>, <span class="variable">$length</span>) === <span class="variable">$domain</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$referrer</span> = @<span class="variable">$_SERVER</span>[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (startsWith(<span class="variable">$referrer</span>, <span class="string">"http://example.com:8082"</span>)) &#123;</span><br><span class="line">    <span class="variable">$js_code</span> = <span class="string">'function jquery() &#123; return "security content";&#125;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$js_code</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$js_code</span> = <span class="string">'function jquery() &#123; return "nothing";&#125;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$js_code</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/前端安全/">#前端安全</a></li>
    
  </ul>

    
      <a href="/2017/09/01/use-request-merging-to-bypass-referer-check/#more" class="post-foot-link fr">阅读全文</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/09/01/ddctf-web-xss-sqli-writeup/">ddctf 两道web题的Writeup (sqli &amp; xss)</a>
      </h2>
    
  

    
<time datetime="2017-08-31T19:01:10.000Z" class="post-time">2017-09-01</time>

  </header>
  
  <section class="post-content typo">
    
      <p><em>更新两篇之前在其他地方发过的文章</em></p>
<h2 id="sqli">sqli</h2><p>地址: <a href="http://118.190.134.8/t1/news.php?id=1">http://118.190.134.8/t1/news.php?id=1</a></p>
<p>尝试sql注入，会发现过滤了’和空格等。使用<br><a href="http://118.190.134.8/t1/news.php?id=1%0aand%0a1=1">http://118.190.134.8/t1/news.php?id=1%0aand%0a1=1</a> 和 <a href="http://118.190.134.8/t1/news.php?id=1%0aand%0a1=2">http://118.190.134.8/t1/news.php?id=1%0aand%0a1=2</a> 判断注入存在，开始思考出数据的方法</p>
<p><a href="http://118.190.134.8/t1/news.php?id=1%0aorder%0aby%0a5">http://118.190.134.8/t1/news.php?id=1%0aorder%0aby%0a5</a><br>判断字段数为4</p>
<p><a href="http://118.190.134.8/t1/news.php?id=1union%0aselect%0a1,2,3,4">http://118.190.134.8/t1/news.php?id=1union%0aselect%0a1,2,3,4</a><br>发现过滤了逗号</p>
<p>那就不好用union出数据了，可选择使用盲注出数据比如<code>(select%a0ascii(substr((select%a0TABLE_NAME%a0from%a0information_schema.tables%a0where%a0TABLE_TYPE%a0=%a0&quot;BASE%a0TABLE&quot;%a0limit%a01%a0OFFSET%a02)%a0from%a01%a0for%a01))=1)%23</code>。但是这里其实有一个union出数据的tip可以使用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql $&#62; select 1,2,3,4 Union select * from (select 1)a join (select 2)b join (select 3)c join (select 4)d&#10;+-----+-----+-----+-----+&#10;|   1 |   2 |   3 |   4 |&#10;|-----+-----+-----+-----|&#10;|   1 |   2 |   3 |   4 |&#10;+-----+-----+-----+-----+</span><br></pre></td></tr></table></figure>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/CTF/">#CTF</a></li>
    
  </ul>

    
      <a href="/2017/09/01/ddctf-web-xss-sqli-writeup/#more" class="post-foot-link fr">阅读全文</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/04/12/Django-CVE-2017-7233-bypass-is-safe-url-and-CVE-2017-7233-serve-open-url/">Django的两则url跳转漏洞:CVE-2017-7233和CVE-2017-7234分析</a>
      </h2>
    
  

    
<time datetime="2017-04-12T15:55:00.000Z" class="post-time">2017-04-12</time>

  </header>
  
  <section class="post-content typo">
    
      <p><a href="https://www.djangoproject.com/weblog/2017/apr/04/security-releases/">Django官方News&amp;Event</a>在4月4日发布了一个安全更新，修复了两个URL跳转的漏洞，一个是urlparse的锅，另一个来自国内的安全研究员 phithon@长亭,都非常漂亮。因为有复现Django漏洞的习惯，晚上抽了点时间复现了一下。有趣的点还挺多。把两个漏洞的分析整合在一起，凑了篇文章。（还是研究漏洞有趣啊，泪流满面QAQ）</p>
<h2 id="CVE-2017-7233分析">CVE-2017-7233分析</h2><p>国外安全研究员roks0n提供给Django官方的一个漏洞。</p>
<p><img src="http://ww1.sinaimg.cn/large/005y7Ba5gy1fekb8wapitj317d0pxage.jpg" alt=""></p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/漏洞分析/">#漏洞分析</a></li>
    
  </ul>

    
      <a href="/2017/04/12/Django-CVE-2017-7233-bypass-is-safe-url-and-CVE-2017-7233-serve-open-url/#more" class="post-foot-link fr">阅读全文</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/01/09/chrome-ext-spider-for-probe/">Chrome Extensions Spider &amp; Downloader</a>
      </h2>
    
  

    
<time datetime="2017-01-09T05:42:21.000Z" class="post-time">2017-01-09</time>

  </header>
  
  <section class="post-content typo">
    
      <p>可以先看一下n0r00t的文章的这一篇:<a href="https://www.n0tr00t.com/2017/01/09/Chrome-Extensions-Probe.html">https://www.n0tr00t.com/2017/01/09/Chrome-Extensions-Probe.html</a>。<br>以及用chrome试用一下最后的成果POC:<a href="http://server.n0tr00t.com/chrome/ext_probe.html">http://server.n0tr00t.com/chrome/ext_probe.html</a>，可以探测Chrome中已安装的扩展，配合Chrome扩展的一些漏洞，说不定能达到定点攻击的效果。<br>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/安全研究/">#安全研究</a></li>
    
  </ul>

    
      <a href="/2017/01/09/chrome-ext-spider-for-probe/#more" class="post-foot-link fr">阅读全文</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2016/12/15/n0js-case1-writeup/">n0js case1 writeup</a>
      </h2>
    
  

    
<time datetime="2016-12-15T07:46:50.000Z" class="post-time">2016-12-15</time>

  </header>
  
  <section class="post-content typo">
    
      <p><em>跟着蘑菇老师学前端安全第一弹[二哈]</em></p>
<p>地址：</p>
<p><a href="http://server.n0tr00t.com/n0js/case1.html">http://server.n0tr00t.com/n0js/case1.html</a></p>
<p>主要代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a1, a2, a3</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;a1&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">`<span class="subst">$&#123;a2&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">`<span class="subst">$&#123;a3&#125;</span>`</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> x = location.hash;</span><br><span class="line">l1 = <span class="built_in">escape</span>(x.split(<span class="string">'#'</span>)[<span class="number">1</span>]);</span><br><span class="line">l2 = x.split(<span class="string">'#'</span>)[<span class="number">2</span>];</span><br><span class="line">l3 = x.split(<span class="string">'#'</span>)[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">if</span> (l1 === <span class="string">'undefined'</span> || l1.length &gt;= <span class="number">30</span>) &#123;</span><br><span class="line">    a1</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (l2 === <span class="string">'undefined'</span> || l2.length &gt;= <span class="number">35</span>) &#123;</span><br><span class="line">    a2</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> v = [<span class="string">'1'</span>, l2, <span class="string">'3'</span>];</span><br><span class="line"><span class="keyword">if</span> (l1.indexOf(<span class="string">';'</span>) &gt;= <span class="number">0</span> || l2.indexOf(<span class="string">'('</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    a3</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (l2.indexOf(<span class="string">'/'</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    b1</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (l3.indexOf(<span class="string">']'</span>) &gt;= <span class="number">0</span> || l3.length &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    c3</span><br><span class="line">&#125;; &#123;</span><br><span class="line">    d = l1 + <span class="string">'v'</span> + l3.trim();</span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'test('</span> + d + <span class="string">')'</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/前端安全/">#前端安全</a></li>
    
  </ul>

    
      <a href="/2016/12/15/n0js-case1-writeup/#more" class="post-foot-link fr">阅读全文</a>
    
    </section>
  </footer>
  
</article>
  
  
    <nav class="page-nav">
      
      
        <a href="/page/2/">下一页 &raquo;</a>
      
    </nav>
  
</section>
    </div>
  <!-- </div> -->
    <footer id="footer">
    <div class="foot-warp">
      <p>© 2014 Nearg1e</p>
    </div>
  </footer>
  <script src="/js/tools.js"></script>
  
  
  <script>
    var disqus_shortname = 'neargle';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  
  
</body>
</html>

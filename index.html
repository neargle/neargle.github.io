<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  
  <title>Nearg1e - Web Develop&amp;Security / 安全研究 / 漏洞挖掘 / 安全开发 / Pyer / Anime</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="/js/highlight.pack.js"></script>
  <script type="text/javascript" src="https://tajs.qq.com/stats?sId=58637942" charset="UTF-8"></script>
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link rel="alternative" href="/atom.xml" title="Nearg1e" type="application/atom+xml">
  
  <!--[if lt IE 9]>
    <script type="text/javascript" src="/js/html5.js"></script>
    <script type="text/javascript" src="/js/css3-mediaqueries.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">

</head>
<body>
    <header id="header">
    <div class="nav-warp">
      <nav id="nav" class="w">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/about/#link">Link</a>
        
          <a class="main-nav-link" href="/atom.xml">RSS</a>
        
          <a class="main-nav-link" href="https://github.com/neargle">Project</a>
        
        <a id="nav-search" class="icon-search fr" onclick="show_search()" title="Search"></a>
        <div id="nav-search-input" class="hide">
          <form class="search-form" onsubmit="return dispatch()">
            <input type="hidden" id="site" value="site:https://blog.neargle.com">
            <input type="text" id="q" class="input-text" name="q" placeholder="Search">
            <input type="submit" value="" class="input-submit">
          </form>
        </div>
      </nav>
    </div>
    
      <div id="logo">
        <div class="hg">
        
          <h1 id="site-title">
            <a href="/">Nearg1e</a>
          </h1>
          
            <h2 id="site-description">Web Develop&amp;Security / 安全研究 / 漏洞挖掘 / 安全开发 / Pyer / Anime</h2>
          
        
          <!-- <p>微博:<a href="http://weibo.com/neargle">@Neargle</a></p> -->
        </div>
      </div>
    
  </header>

  <!-- <div id='wrap'> -->
    <div id='outer'>
      <section id="main">
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2018/01/29/ver-observer-a-tool-about-version-detection/">VER-OBSERVER 一个可以探测框架及依赖版本的命令行工具</a>
      </h2>
    
  

    
<time datetime="2018-01-28T19:01:11.000Z" class="post-time">2018-01-29</time>

  </header>
  
  <section class="post-content typo">
    
      <p>项目地址: <a href="https://github.com/neargle/ver-observer" target="_blank" rel="noopener">https://github.com/neargle/ver-observer</a></p>
<p><img src="http://ww1.sinaimg.cn/large/005y7Ba5ly1fnxt3m57cfj31cf0lktap.jpg" alt=""></p>
<p>用最著名的文学情感类博客测试一下, 看看效果。请大家测试的时候请参照这个 <a href="https://asciinema.org/a/ua1WOqMkUummi25QxImlFRNpN" target="_blank" rel="noopener">视频</a>，自己搭建 django 环境，不要浪费博主的流量，谢谢。</p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/编程开发/">#编程开发</a></li>
    
  </ul>

    
      <a href="/2018/01/29/ver-observer-a-tool-about-version-detection/#more" class="post-foot-link fr">READ MORE</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2018/01/21/yulong-hids-windows-eventlog-iteration/">使用 golang 解析 Windows 日志的四种方法</a>
      </h2>
    
  

    
<time datetime="2018-01-21T05:28:54.000Z" class="post-time">2018-01-21</time>

  </header>
  
  <section class="post-content typo">
    
      <h2 id="关于驭龙HIDS"><a href="#关于驭龙HIDS" class="headerlink" title="关于驭龙HIDS"></a>关于驭龙HIDS</h2><p>驭龙HIDS (<a href="https://github.com/ysrc/yulong-hids" target="_blank" rel="noopener">https://github.com/ysrc/yulong-hids</a>) 是一款由 YSRC 开发的入侵检测系统，集异常检测、监控管理为一体，拥有异常行为发现、快速阻断、高级分析等功能，可从多个维度行为信息中发现入侵行为。当前，驭龙agent主要会收集系统信息，计划任务，存活端口，登录日志，进程信息，服务信息，启动项，用户列表，web路径等信息，其中Windows用户登录信息读取了Windows的EventLog，经历了几个版本，更换了好几个方法，最终成型。这篇文章就稍微说一下这几种方法的思路和实现。如果有更好的思路或实现，期待各位交流指教。</p>
<h2 id="Windows事件查看器与日志ID"><a href="#Windows事件查看器与日志ID" class="headerlink" title="Windows事件查看器与日志ID"></a>Windows事件查看器与日志ID</h2><p>我们知道Windows会把系统登录日志记录在Windows安全日志里，我们可以在事件查看器里筛选查看这些系统日志。</p>
<p><img src="http://ww1.sinaimg.cn/large/005y7Ba5gy1fnn10g8af8j315e0nbjuj.jpg" alt=""></p>
<p>那如果要看登录相关的系统日志呢？可以用事件ID进行筛选，其中登录失败的事件ID为 4625， 而成功的登录ID为 4624。大部分的登录信息会包含在这两个事件ID里面。</p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/golang-hids/">#golang, hids</a></li>
    
  </ul>

    
      <a href="/2018/01/21/yulong-hids-windows-eventlog-iteration/#more" class="post-foot-link fr">READ MORE</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/09/28/Exploiting-Python-PIL-Module-Command-Execution-Vulnerability/">Exploiting Python PIL Module Command Execution Vulnerability</a>
      </h2>
    
  

    
<time datetime="2017-09-28T05:28:54.000Z" class="post-time">2017-09-28</time>

  </header>
  
  <section class="post-content typo">
    
      <p>这是我用来支持先知和代码审计小密圈活动的文章，首发于: <a href="https://xianzhi.aliyun.com/forum/read/2163.html" target="_blank" rel="noopener">https://xianzhi.aliyun.com/forum/read/2163.html</a></p>
<p><strong>PIL</strong> (Python Image Library) 应该是 Python 图片处理库中运用最广泛的，它拥有强大的功能和简洁的API。很多Python Web应用在需要实现处理图片的功能时，都会选择使用PIL。</p>
<p>PIL在对 eps 图片格式进行处理的时候，如果环境内装有 GhostScript，则会调用 GhostScript 在dSAFER模式下处理图片，即使是最新版本的PIL模块，也会受到 <code>GhostButt CVE-2017-8291</code> dSAFER模式Bypass漏洞的影响，产生命令执行漏洞。</p>
<p>据说大牛们看源码和 dockerfile 就可以了：<a href="https://github.com/neargle/PIL-RCE-By-GhostButt" target="_blank" rel="noopener">https://github.com/neargle/PIL-RCE-By-GhostButt</a></p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/Python/">#Python</a></li>
    
  </ul>

    
      <a href="/2017/09/28/Exploiting-Python-PIL-Module-Command-Execution-Vulnerability/#more" class="post-foot-link fr">READ MORE</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/09/01/use-request-merging-to-bypass-referer-check/">使用request merging bypass referer(jsonp) 检测</a>
      </h2>
    
  

    
<time datetime="2017-08-31T19:01:11.000Z" class="post-time">2017-09-01</time>

  </header>
  
  <section class="post-content typo">
    
      <p><em>更新两篇之前在其他地方发过的文章</em></p>
<h2 id="1-关于request-merging和其会产生的问题"><a href="#1-关于request-merging和其会产生的问题" class="headerlink" title="1. 关于request merging和其会产生的问题"></a>1. 关于request merging和其会产生的问题</h2><p>request merging : 浏览器会把多次相同的请求(并非所有请求)合并成一次，以加快资源加载速度。</p>
<p>e.g.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://0.0.0.0:8888/jsonp/1"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://0.0.0.0:8888/jsonp/1"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://0.0.0.0:8888/jsonp/1"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>只会请求并加载一次”<a href="http://0.0.0.0:8888/jsonp/1&quot;资源。" target="_blank" rel="noopener">http://0.0.0.0:8888/jsonp/1&quot;资源。</a></p>
<p><em>曾经有研究指出，这种请求合并想象在iframe里也存在</em>，那么浏览器的这种特性就可以用来bypass部分程序的referer的判断，如jsonp的防御机制。</p>
<h2 id="2-环境和POC"><a href="#2-环境和POC" class="headerlink" title="2. 环境和POC"></a>2. 环境和POC</h2><p>绕过referer检测，攻击者能否拿到进行referer保护的用户信息？</p>
<p>攻击者服务器： <a href="http://example.com:8081" target="_blank" rel="noopener">http://example.com:8081</a><br>目标服务器： <a href="http://example.com:8082" target="_blank" rel="noopener">http://example.com:8082</a><br>referer检测： referer是否以“<a href="http://example.com:8082”开头" target="_blank" rel="noopener">http://example.com:8082”开头</a><br>目标： 攻击者拿到属于用户的 “security content”</p>
<h3 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h3><p>/jsonp.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startsWith</span><span class="params">($url, $domain)</span> </span>&#123;</span><br><span class="line">     $length = strlen($domain);</span><br><span class="line">     <span class="keyword">return</span> (substr($url, <span class="number">0</span>, $length) === $domain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$referrer = @$_SERVER[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (startsWith($referrer, <span class="string">"http://example.com:8082"</span>)) &#123;</span><br><span class="line">    $js_code = <span class="string">'function jquery() &#123; return "security content";&#125;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> $js_code;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $js_code = <span class="string">'function jquery() &#123; return "nothing";&#125;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> $js_code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/前端安全/">#前端安全</a></li>
    
  </ul>

    
      <a href="/2017/09/01/use-request-merging-to-bypass-referer-check/#more" class="post-foot-link fr">READ MORE</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/09/01/ddctf-web-xss-sqli-writeup/">ddctf 两道web题的Writeup (sqli &amp; xss)</a>
      </h2>
    
  

    
<time datetime="2017-08-31T19:01:10.000Z" class="post-time">2017-09-01</time>

  </header>
  
  <section class="post-content typo">
    
      <p><em>更新两篇之前在其他地方发过的文章</em></p>
<h2 id="sqli"><a href="#sqli" class="headerlink" title="sqli"></a>sqli</h2><p>地址: <a href="http://118.190.134.8/t1/news.php?id=1" target="_blank" rel="noopener">http://118.190.134.8/t1/news.php?id=1</a></p>
<p>尝试sql注入，会发现过滤了’和空格等。使用<br><a href="http://118.190.134.8/t1/news.php?id=1%0aand%0a1=1" target="_blank" rel="noopener">http://118.190.134.8/t1/news.php?id=1%0aand%0a1=1</a> 和 <a href="http://118.190.134.8/t1/news.php?id=1%0aand%0a1=2" target="_blank" rel="noopener">http://118.190.134.8/t1/news.php?id=1%0aand%0a1=2</a> 判断注入存在，开始思考出数据的方法</p>
<p><a href="http://118.190.134.8/t1/news.php?id=1%0aorder%0aby%0a5" target="_blank" rel="noopener">http://118.190.134.8/t1/news.php?id=1%0aorder%0aby%0a5</a><br>判断字段数为4</p>
<p><a href="http://118.190.134.8/t1/news.php?id=1union%0aselect%0a1,2,3,4" target="_blank" rel="noopener">http://118.190.134.8/t1/news.php?id=1union%0aselect%0a1,2,3,4</a><br>发现过滤了逗号</p>
<p>那就不好用union出数据了，可选择使用盲注出数据比如<code>(select%a0ascii(substr((select%a0TABLE_NAME%a0from%a0information_schema.tables%a0where%a0TABLE_TYPE%a0=%a0&quot;BASE%a0TABLE&quot;%a0limit%a01%a0OFFSET%a02)%a0from%a01%a0for%a01))=1)%23</code>。但是这里其实有一个union出数据的tip可以使用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql $&gt; select 1,2,3,4 Union select * from (select 1)a join (select 2)b join (select 3)c join (select 4)d</span><br><span class="line">+-----+-----+-----+-----+</span><br><span class="line">|   1 |   2 |   3 |   4 |</span><br><span class="line">|-----+-----+-----+-----|</span><br><span class="line">|   1 |   2 |   3 |   4 |</span><br><span class="line">+-----+-----+-----+-----+</span><br></pre></td></tr></table></figure>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/CTF/">#CTF</a></li>
    
  </ul>

    
      <a href="/2017/09/01/ddctf-web-xss-sqli-writeup/#more" class="post-foot-link fr">READ MORE</a>
    
    </section>
  </footer>
  
</article>
  
    <article class="post">
  <header class="post-head">
    
  
    
      <h2 class="post-title">
        <a href="/2017/04/12/Django-CVE-2017-7233-bypass-is-safe-url-and-CVE-2017-7233-serve-open-url/">Django的两则url跳转漏洞:CVE-2017-7233和CVE-2017-7234分析</a>
      </h2>
    
  

    
<time datetime="2017-04-12T15:55:00.000Z" class="post-time">2017-04-12</time>

  </header>
  
  <section class="post-content typo">
    
      <p><a href="https://www.djangoproject.com/weblog/2017/apr/04/security-releases/" target="_blank" rel="noopener">Django官方News&amp;Event</a>在4月4日发布了一个安全更新，修复了两个URL跳转的漏洞，一个是urlparse的锅，另一个来自国内的安全研究员 phithon@长亭,都非常漂亮。因为有复现Django漏洞的习惯，晚上抽了点时间复现了一下。有趣的点还挺多。把两个漏洞的分析整合在一起，凑了篇文章。（还是研究漏洞有趣啊，泪流满面QAQ）</p>
<h2 id="CVE-2017-7233分析"><a href="#CVE-2017-7233分析" class="headerlink" title="CVE-2017-7233分析"></a>CVE-2017-7233分析</h2><p>国外安全研究员roks0n提供给Django官方的一个漏洞。</p>
<p><img src="http://ww1.sinaimg.cn/large/005y7Ba5gy1fekb8wapitj317d0pxage.jpg" alt=""></p>
    
  </section>
  
  <footer class="post-foot">
    <section class="post-foot-warp clear">
    
  <ul class="post-tag home-tag icon-tag fl">
    
      <li><a href="/tags/漏洞分析/">#漏洞分析</a></li>
    
  </ul>

    
      <a href="/2017/04/12/Django-CVE-2017-7233-bypass-is-safe-url-and-CVE-2017-7233-serve-open-url/#more" class="post-foot-link fr">READ MORE</a>
    
    </section>
  </footer>
  
</article>
  
  
    <nav class="page-nav">
      
      
        <a href="/page/2/">Next &raquo;</a>
      
    </nav>
  
</section>
    </div>
  <!-- </div> -->
    <footer id="footer">
    <div class="foot-warp">
      <p>© 2014 Nearg1e</p>
    </div>
  </footer>
  <script src="/js/tools.js"></script>
  
  
  <script>
    var disqus_shortname = 'neargle';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  
  
</body>
</html>
